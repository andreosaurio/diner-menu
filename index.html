<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bottega Diner</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>

</head>
<body>
    <script>

        const desayuno = {
            tostadas: {
                nombre: "Tostadas",
                precio: 4,
                personalizaciones: {
                    "mermelada": { nombre: "Mermelada de fresa", precio: 0.75 }
                }
            },
            churros: {
                nombre: "Churros",
                precio: 3.25,
                personalizaciones: {
                    "chocolate": { nombre: "Chocolate a la taza", precio: 2 },
                }
            },
            tortilla: {
                nombre: "Tortilla",
                precio: 4.50,
                personalizaciones: {
                    "pan": { nombre: "Pan con tomate", precio: 1.5 },
                }
            },
            croissant: {
                nombre: "Croissant",
                precio: 2.5,
                personalizaciones: {
                    "mermelada": { nombre: "Mermelada de fresa", precio: 0.75 }
                }
            }
        };

        const principales = {
            hamburguesa: {
                nombre: "Hamburguesa",
                precio: { comida: 8.5, cena: 10 },
                personalizaciones: {
                    "huevo": { nombre: "huevo frito", precio: 2 }
                },
            },
            sandwich: {
                nombre: "Sándwich",
                precio: { comida: 7, cena: 7.5 },
                personalizaciones: {
                    "queso": { nombre: "cheddar", precio: 0.5 }
                }
            },
            pescado: {
                nombre: "Pescado",
                precio: { comida: 9.5, cena: 11 },
                personalizaciones: {
                    "verduras": { nombre: "verduras asadas", precio: 2 }
                    }
            },
            pasta: {
                nombre: "Pasta",
                precio: { comida: 6.25, cena: 7.75 },
                personalizaciones: {
                    "queso": { nombre: "parmesano", precio: 1 },
                }
            }
        }  

        const acompanantes = {
            patatas: {
                nombre: "Patatas",
                precio: { comida: 5, cena: 5.5 },
            },
            alitas: {
                nombre: "Alitas",
                precio: { comida: 6, cena: 6.75 },
            },
            ensalada: {
                nombre: "Ensalada",
                precio: { comida: 6, cena: 6.25 },
            }
        }
        
function capitalize(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
}

function validarFormatoHora(hora) {
    const horaRegex = /^(?:2[0-3]|[01]?[0-9]):[0-5][0-9]$/; // Expresión regular para validar el formato HH:mm
    return horaRegex.test(hora);
}

let horaActualString = prompt("¡Bienvenido a Bottega Diner!\n\nPor favor, introduce la hora actual en formato HH:mm (por ejemplo, 08:30):");

// Validar el formato de la hora
while (!validarFormatoHora(horaActualString)) {
    horaActualString = prompt("La hora introducida no está en el formato correcto (HH:mm) o está fuera del rango válido (00:00 a 23:59).\n\nPor favor, introduce la hora actual en formato HH:mm (por ejemplo, 08:30):");
}

const horaActual = moment(horaActualString, 'HH:mm');

// Definir los horarios de apertura y cierre para cada servicio
const horarioDesayunoInicio = moment('07:59', 'HH:mm');
const horarioDesayunoFin = moment('12:01', 'HH:mm');
const horarioComidaInicio = moment('13:29', 'HH:mm');
const horarioComidaFin = moment('16:01', 'HH:mm');
const horarioCenaInicio = moment('20:29', 'HH:mm');
const horarioCenaFin = moment('23:31', 'HH:mm');

// Función para determinar qué menú mostrar según la hora introducida
function obtenerMenu(hora) {
    if (hora.isBetween(horarioDesayunoInicio, horarioDesayunoFin)) {
        mostrarDesayuno();
    } else if (hora.isBetween(horarioComidaInicio, horarioComidaFin)) {
        mostrarComida();
    } else if (hora.isBetween(horarioCenaInicio, horarioCenaFin)) {
        mostrarCena();
    } else {
        // Si el restaurante está cerrado, determinar la próxima apertura
        if (hora.isBefore(horarioDesayunoInicio)) {
            return `El restaurante está cerrado. La próxima apertura será a las 8:00h para el desayuno.\n\n¡Nos vemos por la mañana!`;
        } else if (hora.isBefore(horarioComidaInicio)) {
            return `El restaurante está cerrado. La próxima apertura será a las 13:30h para la comida.\n\n¡Nos vemos más tarde!`;
        } else if (hora.isBefore(horarioCenaInicio)) {
            return `El restaurante está cerrado. La próxima apertura será a las 20:30 para la cena.\n\n¡Nos vemos a la noche!`;
        } else {
            // Si la hora actual es después del horario de cierre de la cena
            return `El restaurante está cerrado por hoy. Volvemos mañana a partir de las 8:00h con nuestros desayunos.`;
        }
    }
    return menuActual
}


const menuActual = obtenerMenu(horaActual);


alert(menuActual);

function personalizarDesayuno(eleccionDesayuno) {
    switch (eleccionDesayuno) {
        case "tostadas":
            var precioMermelada = desayuno[eleccionDesayuno].personalizaciones.mermelada.precio;
            var mermeladaFresa = desayuno[eleccionDesayuno].personalizaciones.mermelada.nombre;
            var personalizacionTostadas = prompt("¿Deseas añadir " + mermeladaFresa + " a tus " + eleccionDesayuno + " por " + precioMermelada + "€ más? (Sí/No)").toLowerCase();
            if (personalizacionTostadas === "sí" || personalizacionTostadas === "si") {
                return precioMermelada;
            } else if (personalizacionTostadas === "no" ) {
                return 0; 
            } else {
                alert("Lo sentimos, debes introducir 'sí' o 'no'.");
                return "Lo sentimos, debes introducir 'sí' o 'no'. " + personalizarDesayuno(eleccionDesayuno);            }
            break;
        case "churros":
            var precioChocolate = desayuno[eleccionDesayuno].personalizaciones.chocolate.precio;
            var chocolateTaza = desayuno[eleccionDesayuno].personalizaciones.chocolate.nombre;
            var personalizacionChurros = prompt("¿Deseas acompañar tus " + eleccionDesayuno + " con " + chocolateTaza + " por " + precioChocolate + "€ más? (Sí/No)").toLowerCase();
            if (personalizacionChurros === "sí" || personalizacionChurros === "si") {
                return precioChocolate;
            } else if (personalizacionChurros === "no" ) {
                return 0; 
            } else {
                alert("Lo sentimos, debes introducir 'sí' o 'no'.");
                return "Lo sentimos, debes introducir 'sí' o 'no'. " + personalizarDesayuno(eleccionDesayuno);            }
            break;
        case "tortilla":
            var precioPan = desayuno[eleccionDesayuno].personalizaciones.pan.precio;
            var panTomate = desayuno[eleccionDesayuno].personalizaciones.pan.nombre;
            var personalizacionTortilla = prompt("¿Deseas añadir " + panTomate + " a tu " + eleccionDesayuno + " por " + precioPan + "€ más? (Sí/No)").toLowerCase();
            if (personalizacionTortilla === "sí" || personalizacionTortilla === "si") {
                return precioPan;
            } else if (personalizacionTortilla === "no" ) {
                return 0; 
            } else {
                alert("Lo sentimos, debes introducir 'sí' o 'no'.");
                return "Lo sentimos, debes introducir 'sí' o 'no'. " + personalizarDesayuno(eleccionDesayuno);            }
            break;
        case "croissant":
            var precioMermeladaCroissant = desayuno[eleccionDesayuno].personalizaciones.mermelada.precio;
            var mermeladaFresaCroissant = desayuno[eleccionDesayuno].personalizaciones.mermelada.nombre;
            var personalizacionCroissant = prompt("¿Deseas añadir " + mermeladaFresaCroissant + " a tu " + eleccionDesayuno + " por " + precioMermeladaCroissant + "€ más? (Sí/No)").toLowerCase();
            if (personalizacionCroissant === "sí" || personalizacionCroissant === "si") {
                return precioMermeladaCroissant;
            } else if (personalizacionCroissant === "no" ) {
                return 0; 
            } else {
                alert("Lo sentimos, debes introducir 'sí' o 'no'.");
                return "Lo sentimos, debes introducir 'sí' o 'no'. " + personalizarDesayuno(eleccionDesayuno);            }
            break;
    }
}


function mostrarDesayuno() {
    var mensajeDesayuno = "Esta es nuestra carta de desayunos:\n\n";
    var i = 1;
    for (var platoDesayuno in desayuno) {
        mensajeDesayuno += i + ". " + capitalize(platoDesayuno) + ": " + desayuno[platoDesayuno].precio.toFixed(2) + "€\n";
        i++;
    }
    var eleccionDesayuno = parseInt(prompt(mensajeDesayuno + "\n¿Qué deseas tomar? Escribe el número correspondiente al plato:"));

    if (eleccionDesayuno >= 1 && eleccionDesayuno <= i -1 ) {
        eleccionDesayuno--; 

        var platoSeleccionado = Object.keys(desayuno)[eleccionDesayuno];
        var precioBase = desayuno[platoSeleccionado].precio;
        var precioPersonalizacion = personalizarDesayuno(platoSeleccionado);

        imprimirTicketDesayuno(platoSeleccionado, precioBase, precioPersonalizacion);

        return;
    } else {
        alert("Selección inválida. Por favor, elige un número válido.");
        mostrarDesayuno();
    }
}

function imprimirTicketDesayuno(plato, precioBase, precioPersonalizacion) {
    var mensaje = "¡Muchas gracias por visitar Botega Diner!\nAquí tiene su ticket:\n\n";
    mensaje += capitalize(plato) + " " + precioBase.toFixed(2) + "€\n";
    
    if (precioPersonalizacion > 0) {
        var nombrePersonalizacion = desayuno[plato].personalizaciones[Object.keys(desayuno[plato].personalizaciones)[0]].nombre;
        mensaje += "Extra:\n";
        mensaje += "    - " + nombrePersonalizacion + ": " + precioPersonalizacion.toFixed(2) + "€\n";
    }

    mensaje += "\nImporte total a pagar: " + (precioBase + precioPersonalizacion).toFixed(2) + "€\n\n¡Disfrute de su pedido!";
    
    alert(mensaje);
}


function mostrarPrincipales(menuActual) {
    var mensajePrincipales = "Estos son los principales de nuestra carta de " + menuActual + ":\n\n";
    var i = 1;
    for (var platoPrincipal in principales) {
        mensajePrincipales += i + ". " + capitalize(platoPrincipal) + ": " + principales[platoPrincipal].precio[menuActual].toFixed(2) + "€\n";
        i++;
    }
    var eleccionPrincipal = parseInt(prompt(mensajePrincipales + "\n¿Qué deseas tomar? Escribe el número correspondiente al plato:"));

    if (eleccionPrincipal >= 1 && eleccionPrincipal <= i - 1) {
        eleccionPrincipal--; 

        switch (menuActual) {
            case "comida":
                switch (eleccionPrincipal) {
                    case 0: // Hamburguesa
                        alert("Buena elección, nuestra carne proviene de las mejores vacas.");
                        break;
                    case 1: // Sandwich
                        alert("Buena elección, nuestros sandwiches están deliciosos.");
                        break;
                    case 2: // Pescado
                        alert("Buena elección, nuestro pescado siempre es fresco.");
                        break;
                    case 3: // Pasta
                        alert("Buena elección, elaboramos a diario todas nuestras pastas.");
                        break;
                }
                break;
            case "cena":
                switch (eleccionPrincipal) {
                    case 0: // Hamburguesa
                        alert("Buena elección, nuestra hamburguesa es un clásico de la cena.");
                        break;
                    case 1: // Sandwich
                        alert("Buena elección, un sandwich siempre es una buena opción para la cena.");
                        break;
                    case 2: // Pescado
                        alert("Buena elección, el pescado es ligero y nutritivo para la cena.");
                        break;
                    case 3: // Pasta
                        alert("Buena elección, una pasta es reconfortante para la cena.");
                        break;
                }
                break;
        }

        var nombreEleccionPrincipal = Object.keys(principales)[eleccionPrincipal];
        var precioEleccionPrincipal = principales[nombreEleccionPrincipal].precio[menuActual];
        var precioPersonalizacion = personalizarPrincipales(nombreEleccionPrincipal);

        if (precioPersonalizacion > 0) {
            var nombrePersonalizacion = principales[nombreEleccionPrincipal].personalizaciones[Object.keys(principales[nombreEleccionPrincipal].personalizaciones)[0]].nombre;
            alert("De acuerdo, de primer plato pondremos " + nombreEleccionPrincipal + " con " + nombrePersonalizacion + ".");
            return { 
                "nombreEleccionPrincipal": nombreEleccionPrincipal, 
                "precioEleccionPrincipal": precioEleccionPrincipal, 
                "nombrePersonalizacion": nombrePersonalizacion, 
                "precioPersonalizacion": precioPersonalizacion
            };
        } else {
            alert("De acuerdo, de primer plato pondremos " + nombreEleccionPrincipal + ".");
            return { 
                "nombreEleccionPrincipal": nombreEleccionPrincipal, 
                "precioEleccionPrincipal": precioEleccionPrincipal
            };
        }    
    } else {
        alert("Selección inválida. Por favor, elige un número válido.");
        mostrarPrincipales(menuActual);
    }
}

function personalizarPrincipales(eleccionPrincipal) {
    switch (eleccionPrincipal) {
        case "hamburguesa":
            var precioHuevo = principales[eleccionPrincipal].personalizaciones.huevo.precio;
            var huevoFrito = principales[eleccionPrincipal].personalizaciones.huevo.nombre;
            var personalizacionHamburguesa = prompt("¿Deseas añadir " + huevoFrito + " a tu " + eleccionPrincipal + " por " + precioHuevo + "€ más? (Sí/No)").toLowerCase();
            if (personalizacionHamburguesa === "sí" || personalizacionHamburguesa === "si") {
                return precioHuevo;
            } else if (personalizacionHamburguesa === "no" ) {
                return 0; 
            } else {
                alert("Lo sentimos, debes introducir 'sí' o 'no'.");
                return personalizarPrincipales(eleccionPrincipal);
            }
            break;
        case "sandwich":
            var precioQueso = principales[eleccionPrincipal].personalizaciones.queso.precio;
            var quesoCheddar = principales[eleccionPrincipal].personalizaciones.queso.nombre;
            var personalizacionSandwich = prompt("¿Deseas añadir " + quesoCheddar + " a tu " + eleccionPrincipal + " por " + precioQueso + "€ más? (Sí/No)").toLowerCase();
            if (personalizacionSandwich === "sí" || personalizacionSandwich === "si") {
                return precioQueso;
            } else if (personalizacionSandwich === "no" ) {
                return 0; 
            } else {
                alert("Lo sentimos, debes introducir 'sí' o 'no'.");
                return personalizarPrincipales(eleccionPrincipal);
            }
            break;
        case "pescado":
            var precioVerduras = principales[eleccionPrincipal].personalizaciones.verduras.precio;
            var verdurasAsadas = principales[eleccionPrincipal].personalizaciones.verduras.nombre;
            var personalizacionPescado = prompt("¿Deseas acompañar tu " + eleccionPrincipal + " con " + verdurasAsadas + " por " + precioVerduras + "€ más? (Sí/No)").toLowerCase();
            if (personalizacionPescado === "sí" || personalizacionPescado === "si") {
                return precioVerduras;
            } else if (personalizacionPescado === "no" ) {
                return 0; 
            } else {
                alert("Lo sentimos, debes introducir 'sí' o 'no'.");
                return personalizarPrincipales(eleccionPrincipal);
            }
            break;
        case "pasta":
            var precioQuesoPasta = principales[eleccionPrincipal].personalizaciones.queso.precio;
            var quesoParmesano = principales[eleccionPrincipal].personalizaciones.queso.nombre;
            var personalizacionPasta = prompt("¿Deseas añadir " + quesoParmesano + " a tu " + eleccionPrincipal + " por " + precioQuesoPasta + "€ más? (Sí/No)").toLowerCase();
            if (personalizacionPasta === "sí" || personalizacionPasta === "si") {
                return precioQuesoPasta;
            } else if (personalizacionPasta === "no" ) {
                return 0; 
            } else {
                alert("Lo sentimos, debes introducir 'sí' o 'no'.");
                return personalizarPrincipales(eleccionPrincipal);
            }
            break;
    }
}

function mostrarAcompanantes(menuActual) {
    var mensajeInicial = true; 
    var acompanantesElegidos = []; 
    var seguirPidiendo = true;
    
    do {
        var mensajeAcompanantes = ""; // Reinicia el mensaje en cada iteración

        if (mensajeInicial) {
            mensajeAcompanantes = "Estos son los acompañantes que tenemos en la carta:\n\n";
            var i = 1;
            for (var acompanante in acompanantes) {
                mensajeAcompanantes += i + ". " + capitalize(acompanante) + ": " + acompanantes[acompanante].precio[menuActual].toFixed(2) + "€\n";
                i++;
            }
        } else {
            mensajeAcompanantes = "¿Deseas añadir algún acompañante más?\n\n";
            var i = 1;
            for (var acompanante in acompanantes) {
                mensajeAcompanantes += i + ". " + capitalize(acompanante) + "\n";
                i++;
            }
        }

        var eleccionAcompanante = prompt(mensajeAcompanantes + "\nSelecciona el número del acompañante que quieres o escribe 'no' para terminar:");

        if (eleccionAcompanante.toLowerCase() === "no") {
            alert("Entendido, no deseas tomar ningún otro acompañante.\n\nVamos a preparar tu ticket...");
            seguirPidiendo = false;
        } else {
            eleccionAcompanante = parseInt(eleccionAcompanante);
            if (!isNaN(eleccionAcompanante) && eleccionAcompanante >= 1 && eleccionAcompanante <= i - 1) {
                var nombreAcompanante = Object.keys(acompanantes)[eleccionAcompanante - 1];
                var precioAcompanante = acompanantes[nombreAcompanante].precio[menuActual];
                acompanantesElegidos.push({ nombre: nombreAcompanante, precio: precioAcompanante }); // Agrega el acompañante elegido a la colección
                alert("Has elegido " + nombreAcompanante + " como acompañante.");
                mensajeInicial = false; // Después de la primera selección, establecer mensajeInicial a false
            } else {
                if (mensajeInicial) {
                    alert("Selección inválida. Por favor, elige un número válido o escribe 'no' para terminar.");
                } else {
                    alert("Selección inválida. Por favor, elige un número válido o escribe 'no' para terminar.");
                    mensajeInicial = false; 
                }
            }
        }
    } while (seguirPidiendo);

    return acompanantesElegidos; 
}


function imprimirTicket(eleccion, eleccionAcompanantes) {
    var mensaje = "¡Muchas gracias por visitar Botega Diner!\n\n";
    mensaje += capitalize(eleccion.nombreEleccionPrincipal) + ": " + eleccion.precioEleccionPrincipal.toFixed(2) + "€\n";

    if (eleccion.nombrePersonalizacion && eleccion.precioPersonalizacion) {
        mensaje += "Extra:          \n       " + capitalize(eleccion.nombrePersonalizacion) + ": " + eleccion.precioPersonalizacion.toFixed(2) + "€\n";
    }

    if (eleccionAcompanantes && eleccionAcompanantes.length > 0) {
        eleccionAcompanantes.forEach(function(acompanante) {
            mensaje += capitalize(acompanante.nombre) + ": " + acompanante.precio.toFixed(2) + "€\n";
        });
    }

    var total = eleccion.precioEleccionPrincipal + (eleccion.precioPersonalizacion || 0);
    
    if (eleccionAcompanantes && eleccionAcompanantes.length > 0) {
        total += eleccionAcompanantes.reduce(function(acumulador, acompanante) {
            return acumulador + acompanante.precio;
        }, 0);
    }

    mensaje += "\nImporte total a pagar: " + total.toFixed(2) + "€\n\n¡Disfrute de su pedido!";
    
    alert(mensaje);
}

function mostrarComida() {
    var eleccion = mostrarPrincipales("comida");
    var eleccionAcompanantes = mostrarAcompanantes("comida");
    imprimirTicket(eleccion, eleccionAcompanantes); 
}

function mostrarCena() {
    var eleccion = mostrarPrincipales("cena");
    var eleccionAcompanantes = mostrarAcompanantes("cena");
    imprimirTicket(eleccion, eleccionAcompanantes); 
}

   
    </script>
</body>
</html>